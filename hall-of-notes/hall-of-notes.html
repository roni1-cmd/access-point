<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Student Uploads</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <script src="https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js"></script>
</head>
<body>
  <h2>Student File Sharing</h2>

  <!-- Login button -->
  <button id="loginBtn">Login with Google</button>
  <button id="logoutBtn" style="display:none;">Logout</button>

  <!-- Upload section -->
  <div id="uploadSection" style="display:none;">
    <h3>Upload File</h3>

    <!-- Subject dropdown -->
    <label for="subjectSelect">Select Subject:</label>
    <select id="subjectSelect">
      <option value="">-- Choose Subject --</option>
      <option value="COMMUNICATION">COMMUNICATION</option>
      <option value="CULTURE & SOCIETY">CULTURE & SOCIETY</option>
      <option value="INTERPERSONAL COMMUNICATION IN DEVELOPMENT">INTERPERSONAL COMMUNICATION IN DEVELOPMENT</option>
      <option value="THE CONTEMPORARY WORLD">THE CONTEMPORARY WORLD</option>
      <option value="PURPOSIVE COMMUNICATION">PURPOSIVE COMMUNICATION</option>
      <option value="ETHICS">ETHICS</option>
      <option value="INTRODUCTION TO COMMUNICATION MEDIA">INTRODUCTION TO COMMUNICATION MEDIA</option>
    </select>
    <br><br>

    <!-- File uploader -->
    <input type="hidden"
      role="uploadcare-uploader"
      id="fileUploader"
      data-file-types="application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" 
    />
  </div>

  <h3>Uploaded Files</h3>
  <div id="fileList"></div>

  <script>
    // ===== Firebase Setup =====
    const firebaseConfig = {
      apiKey: "AIzaSyAsynsRyRVwNYzOtqG4yDdcy5HWw74aOzY",
      authDomain: "student-s-helpdesk.firebaseapp.com",
      databaseURL: "https://student-s-helpdesk-default-rtdb.firebaseio.com",
      projectId: "student-s-helpdesk",
      storageBucket: "student-s-helpdesk.appspot.com",
      messagingSenderId: "270861175145",
      appId: "1:270861175145:web:b66a5f9fef8ac3104855f8",
      measurementId: "G-VRKD5P955F"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // ===== Auth =====
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const uploadSection = document.getElementById("uploadSection");

    loginBtn.onclick = () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider);
    };
    logoutBtn.onclick = () => auth.signOut();

    auth.onAuthStateChanged(user => {
      if (user) {
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline";
        uploadSection.style.display = "block";
      } else {
        loginBtn.style.display = "inline";
        logoutBtn.style.display = "none";
        uploadSection.style.display = "none";
      }
    });

    // ===== File Upload =====
    const uploader = uploadcare.Widget('#fileUploader');
    uploader.onUploadComplete(fileInfo => {
      const subject = document.getElementById("subjectSelect").value;
      if (!subject) {
        alert("Please choose a subject before uploading.");
        return;
      }
      // Save URL + subject to Firebase
      db.ref("files").push({
        subject: subject,
        url: fileInfo.cdnUrl,
        name: fileInfo.name,
        uploadedAt: Date.now()
      });
    });

    // ===== Display Files =====
    const fileList = document.getElementById("fileList");
    db.ref("files").on("child_added", snapshot => {
      const data = snapshot.val();
      const div = document.createElement("div");
      div.innerHTML = `<b>[${data.subject}]</b> <a href="${data.url}" target="_blank">${data.name}</a>`;
      fileList.appendChild(div);
    });
  </script>
</body>
</html>
